var Promise = require('bluebird');
var vars = require('./capture.vars');
var report = require('./capture.report');

//동영상 관련 처리
var movies = function (page) {

	return new Promise(function (resolve, reject) {

		//jQuery 삽입
		if (page.injectJs(vars.jQueryPath)) {

			var media = page.evaluate(function () {
				var mediaProperties = [];

				//동영상의 절대 위치
				function absolutePostion (element, parentBoundingClientRectTop, parentBoundingClientRectLeft) {
					var selectedPosX = 0;
					var selectedPosY = 0;

					while(element != null){
						selectedPosX += element.offsetLeft;
						selectedPosY += element.offsetTop;
						element = element.offsetParent;
					}

					return [parentBoundingClientRectTop + selectedPosY, parentBoundingClientRectLeft + selectedPosX];
				}

				//flash 관련 정보 추출 및 썸네일로 치환
				function removeFlash (currentDocument) {
					var params = currentDocument.querySelectorAll('param[name="movie"][value*="swf"]');

					[].forEach.call(params, function (item) {
						var object = item.parentNode;
						var width = object.width;
						var height = object.height;

						$(object).replaceWith("<div style=\"position: relative; display: inline-block; width: " + width + "px; height: " + height + "px \"><div style=\"width: 150px;height: 150px;margin-left: -75px;margin-top: -75px;outline: 0;position: absolute;top: 50%;left: 50%;z-index: 840;\"><img width=150 height=150 src=\"data:image/jpeg;base64,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\" /></div></div>");
					});
				}

				//youtube 관련 정보 추출 및 썸네일로 치환
				function replaceYoutube (currentDocument, parentBoundingClientRectTop, parentBoundingClientRectLeft) {
					var iframes = currentDocument.querySelectorAll('iframe[src*="youtube.com"]');
					var embeds = currentDocument.querySelectorAll('embed[src*="youtube.com"]');

					[].forEach.call(iframes, function (item) {
						var src = item.src;
						var id = item.src.match(/.+\/([^\/\?]+)/)[1];
						var width = item.width;
						var height = item.height;
						var thumbnail = "http://img.youtube.com/vi/" + id + "/0.jpg";
						var absolutePos = absolutePostion(item, parentBoundingClientRectTop, parentBoundingClientRectLeft);
						$(item).replaceWith("<div style=\"position: relative;\"><img src='" + thumbnail + "' width=" + width + " height=" + height + "/><div style=\"width: 100px;height: 100px;margin-left: -50px;margin-top: -50px;outline: 0;position: absolute;top: 50%;left: 50%;z-index: 840;\"><img width=100 height=100 src=\"data:image/png;base64,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\" /></div></div>");

						mediaProperties.push({id:id, src:src, width:width, height:height, thumbnail:thumbnail, absolutePos:absolutePos});
					});

					[].forEach.call(embeds, function (item) {
						var src = item.src;
						var id = item.src.match(/.+\/([^\/\?]+)/)[1];
						var width = item.width;
						var height = item.height;
						var thumbnail = "http://img.youtube.com/vi/" + id + "/0.jpg";
						var absolutePos = absolutePostion(item, parentBoundingClientRectTop, parentBoundingClientRectLeft);
						$(item).replaceWith("<div style=\"position: relative;\"><img src='" + thumbnail + "' width=" + width + " height=" + height + "/><div style=\"width: 100px;height: 100px;margin-left: -50px;margin-top: -50px;outline: 0;position: absolute;top: 50%;left: 50%;z-index: 840;\"><img width=100 height=100 src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAadEVYdFNvZnR3YXJlAFBhaW50Lk5FVCB2My41LjExR/NCNwAADTBJREFUeF7tnGlQFNcWx/M+vKrUq3pl5X0yGNxAcUNEUAQclmZHVAICGhVjAFHBKO4YtxhNomXGsIkL7ivjknGNCgZR0VIUd9wRRZBN0e6eZhmG807P9ChIj7jANFj3P/Wzm+7b9557/nNv30GmvyAiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIyjmrLi3qq829TNVdPU1WZB6mqAxupym0rKVX8XIr9JYJiZo2g6CgP6tUkiqJjg4dU7l8rr1Qkyit3rpJzW1fIuY3L5Nz6xXLV2kVybs1CZIFclTxfC7eGZ6Hu3LrFWHYpXrNczuG1lakJ8qp9a+TssogRNF/3ZA+KnuFPqZaEYdtzqMrNy6kq5QaqOuMAVXMlk1Ln3abqSgtMhbBbr2ofXPtP9TGFFZcQG0pHeYeq4mMTubi5CtXSSAU7Z6SCmTIE8T3IrYzh2GWRHLtgHMfODuaYqUM5epIHx0R5qZloH2CivBEvYCbzeAIzyRPoSe7ATEQihW1LEukm7Htg2wgfAx8LHxMfWzQy2bMGz2PsftiHII5dOI7DfnKqldM4Zsa3afQUXwUzd6RC9csEBRc3R8ElL9rA54T9dVJo1cHNw6rT9/9PSFvzq3rTH+3YJRNi2IXfFzJRmNAICugJbgL6fQoYLdhZ7bE36I43PKfb19OwvDHg2xU7po0zQtgK6M7VK4v91+XgTZn65/l62LmjNGzsd9ur9q3zVz/M/ZeQyk9X5Ybfx7MxgYV0mCsw70O4ga3Yfv2fWxtisTUVr9j5SV7ALgpLVSf83E5I6ccJCh5+qfr1x+VMmDvQ37sIuBI+CH3eXICdPbqiamucnZDeDxc7P3y+ttJQZ2BCXRBnYZ/w0UT7v8B7sK2Q4vdX5aoFwfR491p6DJowxonQjLDRAdk1x/b8V0h106o5e6IdO3HYPfo7GTA8o2RAE5oFbS4xp9zSHxcL6W5aqt9mTmRCBgOhpZABGzVCVb1jzZdCyt8t1Yxx1+kRjkAH8TgQmhXMqZBbbtnsECHlhqW+dbUDM9pdxQTgRQFYgQRI2bYxYIQtO23sZiHthlWZuNyOCcIbub89MEYHgx1uD/Rw3Iqe/7xgo0ZeEtJuWNyCqcG0H14wBBPjN8j4+DtB1eYkYMcOAQZ/5hEt9xnAjhlSJqTdsFSzJi2hffACiWCGO4GmuBA0L8qgMmkFjhZcKvricZGybR0mkFKrb161FFIvLuZbahnjhYUlgOa3fjLQPCuCOv5VpwHNgzugmhsNjDeO2rfKt2X4vtJDZVAZv+Ldn9y5aRE5tIcdMBKgbddXBnVoSH3xxtRkpgM7PkhX1l1XlvYY2KiOtgIfO+05CFQTxlJC6sXFBnrnMG4DQBowwd6DtSOkobTjBepULFRtSwFmqKuurBaxetoGNMZfuWzhEiH1jVWbe+srJtivgnbFwhLBeDmKGKJXnfZfTXERdmQBvstw4UHhdTwidbV6MG52lL9hQ6rWJZvQAd7wCgtLxjsN0Ym3pa6uDtRXLwMbHfb62pf162kD8PGy0yJPCulvLCZ8tEkFThkvXG0lo8LLoUlDeOnGCk5jNdVQdUQJLwO9RetrzVQgdOTYHCH9jaVaEz/ouYstPHfmGSAB2K4HGlLUtCFvS8PQoEqOg+deMl09kvXhfbGFcuRFoI9hQ7hNayPKsFCphJS5f5wh/E2flzrvPrycNx1KXQaI1t+6sIFSys6wIS9jp0cUO/UHKSlxGwS1H2HIG6E1mlqoPncGykODoAQ7XexkAyWIWHvSoYupbOQwdVXOxfaCBQ1VEugbUSSzAenoD8+0hhQKyf1waZfH+ldVFbCp26FkqJuubtE2pQTfgP6eQG9YYyJY0FCFMpuIQiwkJUVu9p9kiJjUpcVQsWIpFLkMxDZsGrUpDbo4nnk7w/PZ08UNKV8cu69gsDVIyVPq00aImLSjBZfJVbdvQWl0OBTgVFEwuL+AeBzG4Cm2/xRnhGdjgsUNKZ09VfkYCz5x7CcZBa52oG5mQ3jpbvm4rVWDKu0YFAb5wROJ+6ptH0dJgZu9uCHPosOV+Y7WkI8FJaOFDHlbtfQrqEhJhnycIrV9lrDfL1O3ewoWNNTTcSOVeehcnoN0PMJ53hiG6CYygBpsq3jBbMhzshWNxxi82rs7QrCgofJDhisfOFjBA3sJwQ9NxjGknuo0wGVfgCfjR2ljuK+lX+PYWogXG9aKG/IoaJjyLhaQkvtoCP+ulUIaXCZX7FfAwyEU3BOJraV4npIsbkhe0FDlHXtLuDOor2TcxamjpvCpkCLjSrsaw636ZQWUyH+Huzh93hnU8vkoW79a3JAHI4Yqc+36gpTclvGGGH+E8EboDMEXTmEv04/BXV9X0Ribm5J1Bgy5F+invDHQEqTk5mAbSQzhxX9W4e7cgrzJYXDDTh9TnwbxtQQl65LEDbmDI+QaBnB9gHTcQEOqjWiIflTUlJfB0+VL4IZjf9G4WpISQ/eQu2OClFcG9IarWEgqrjlYoyHGu4do1DVQuns73PByhqu2vUGK/pft2WVgypowTnkZg5KSKy1siG484FajgVfnzkJuiD+22+stxGNrTnLqUbJrq/gHw3sxUcpsm94gJZfsW94QLv8R3J/5I2Tj/C0WgzG4qN/HEXLZcYD4r07uz5u170L/XnDBRjqy0ZCqFjJEzdDwJEEO2biSE2tbCvj+Xg/yFzfkfP9eEeete8G5fj0l4Txywa5fsxmim57qQFNTDaWHlHDZm4Lz1tgOIta+seFzfVE2EO5OjRY35JKPW0QWFszq10MyzttZNash9LUrcH38aMjCkZ+FRuj6J20f65Pt4QQFa5LEDbkdMyXiDBY6iwFLRdZAK6j8CENe/3pdeFU+K4S7C2PhrK2laDutAzRkqJf65eVs8f/CzV+7OuKUlQVIyekBfT/aEJ5aFQuPN66HszI7bX2ZVj0atdFqQEMybfoY/iOHh3/+MeifvhYgJafwHc09/RBDdGOD/5RdmnESLgz3Ea23tZLl7mTYkIshASb/4JSRjgXTJCDdEoO0+TBDtPeJO7mQExmGcXcXrbc1wvc1DeO9MDLQsCEPElaZnHK1hxOW3SThOJKGa/P3NaT6+XO4s3wZpONa/ril+WvE6m598HGaQ/YPYwz/Kemrm9e/ynCXVfzdxxyk4oTWkAIh5Q2lv2Hzy9jHip3wj4u9aB1tiUwfyvAfW/NKd7bPOdrbHKTgCHIMl6cGDanTQOm5s3A2aDiWNROuMdNe93ZdrR9d3NdiZ73bkKwxITmHepmBVBzFzwoqwRD9UpbfUz15DJdnToXDlt0bXXP4rZ/bCofRkNOBw979hZ2M4b7rlT26gFQcwmUqbwg/NfGqoWm4nbAKjuDN/kDPrjp6dBW9tq1xCD+LXF/687u/0nYmdNSS/T06g1QcwBUIi4ZoatXw5KASjns44/Euwnn9tu3zF3LI1lL94loTX/o8Ez4+eC92fK+FNOzH5WDB8aOQOW4U7MWRsNeic6MynwuHBw9s+mvRlxfPt9uL79JUTITR6a7f7wQK3Cq6d9LuNyr3WdAJjvm4N/3ggLIrlzvste6j2tWtE+zW0pHQIqAhw3ybfrQGr7/9fa/v7GYKOwgtypkpUU0/fIbXqagJE7eZdwRCS2CqRUnJVDeTE97v8UyPM9Lb7XGwvbfZzBQ2m31DaGa24Og4GRn2/g8w43V65vTgrb3Nazd17QAbEX5L+Hj4HOrzuMfZITvv6MH3f8SfXodCAuZvwJvP+i4dCJ8KGsGze7Ddi/sHlB/+EExeTPGzL/d4uc1IwTXz2s4mhE9kj7dbxZXkpI9/TKxexyPDh+yQ2RUmo9PJWHFDvia8BvPRiQf3eYRjKb27wYGQwNSLq1Z+2oOU6+tK8up2B8aOitnu5HBrfR8LSOr4tZZEHmycwOfDRJcPZHUXvIEPsC5P9fXcfmbxAge2pLj5HjVeX8U5l/59cmZM+8yFP4Vuc3EKTenfd+KxKZMVf40KUuzwoBQbBlorVnfrotju7nxt7wh/bpePB7fVyYFLsbXiknuac/GdTbiELt/UJOG9KRGXgYlmSFdTwGOQ0LkD4HmIx87FY6d44jq2hzhT/RZ5fawh+vJvrtPxpg6+jL4c34YOvk2+7cSuCK4q+ZiSzDG2rt+o+VhXW5hx2Edui8ye2+ntzu0JGMbt8vW8l9StsyLFth/200WxLzhAcXRypGKLs+O0TfZ2oUfCfwg999uvdje2bv3wG7cUoouLTMvv5lL5mZlUriKVupgQT2X89BN1JCKMSh3mR22RDabW2/SjVluYU3GmJlRSD3PPrOW/yc8s/Vl+asE8+ck5s+Tps2fI02ZOl6fNmC4/MT1GC7+fNguP47l0LJOBZU//slieuWTR0lWm7ak/sa5ECzNqXX8rarPMkdrl50Md+uF76uS8udSFODl1a/cu6lFGBlV+O5eiS4q7CeESERERERERERERERERERERERERERERERERERERGU1ffPF/H0+qxuBT96YAAAAASUVORK5CYII=\" /></div></div>");

						mediaProperties.push({id:id, src:src, width:width, height:height, thumbnail:thumbnail, absolutePos:absolutePos});
					});
				}

				//vimeo 관련 정보 추출 및 썸네일로 치환
				function replaceVimeo (currentDocument, parentBoundingClientRectTop, parentBoundingClientRectLeft) {
					var iframes = currentDocument.querySelectorAll('iframe[src*="player.vimeo.com"]');

					[].forEach.call(iframes, function (item) {
						var src = item.src;
						var id = item.src.match(/.+\/([^\/\?]+)/)[1];
						var width = item.width;
						var height = item.height;
						var thumbnail = "https://i.vimeocdn.com/video/" + id;
						var absolutePos = absolutePostion(item, parentBoundingClientRectTop, parentBoundingClientRectLeft);
						$(item).replaceWith("<div style=\"position: relative;\"><img src='" + thumbnail + "' width=" + width + " height=" + height + "/><div style=\"width: 100px;height: 100px;margin-left: -50px;margin-top: -50px;outline: 0;position: absolute;top: 50%;left: 50%;z-index: 840;\"><img width=100 height=100 src=\"data:image/png;base64,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\" /></div></div>");

						mediaProperties.push({id:id, src:src, width:width, height:height, thumbnail:thumbnail, absolutePos:absolutePos});
					});
				}

				//tvpot 관련 정보 추출 및 썸네일로 치환
				function replaceTvpot (currentDocument, parentBoundingClientRectTop, parentBoundingClientRectLeft) {
					var iframes = currentDocument.querySelectorAll('iframe[src*="videofarm.daum.net"]');
					var embeds = currentDocument.querySelectorAll('embed[src*="videofarm.daum.net"]');

					[].forEach.call(iframes, function (item) {
						var src = item.src;
						var id = item.src.match(/vid=([^&]+)/)[1];
						var width = item.width;
						var height = item.height;
						var thumbnail = "http://i1.daumcdn.net/svc/image/U03/tvpot_thumb/" + id + "/thumb.png";
						var absolutePos = absolutePostion(item, parentBoundingClientRectTop, parentBoundingClientRectLeft);
						$(item).replaceWith("<div style=\"position: relative;\"><img src='" + thumbnail + "' width=" + width + " height=" + height + "/><div style=\"width: 100px;height: 100px;margin-left: -50px;margin-top: -50px;outline: 0;position: absolute;top: 50%;left: 50%;z-index: 840;\"><img width=100 height=100 src=\"data:image/png;base64,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\" /></div></div>");

						mediaProperties.push({id:id, src:src, width:width, height:height, thumbnail:thumbnail, absolutePos:absolutePos});
					});

					[].forEach.call(embeds, function (item) {
						var src = item.src;
						var id = item.flashvars.match(/vid=([^&]+)/)[1];
						var width = item.width;
						var height = item.height;
						var thumbnail = "http://i1.daumcdn.net/svc/image/U03/tvpot_thumb/" + id + "/thumb.png";
						var absolutePos = absolutePostion(item, parentBoundingClientRectTop, parentBoundingClientRectLeft);
						$(item).replaceWith("<div style=\"position: relative;\"><img src='" + thumbnail + "' width=" + width + " height=" + height + "/><div style=\"width: 100px;height: 100px;margin-left: -50px;margin-top: -50px;outline: 0;position: absolute;top: 50%;left: 50%;z-index: 840;\"><img width=100 height=100 src=\"data:image/png;base64,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\" /></div></div>");

						mediaProperties.push({id:id, src:src, width:width, height:height, thumbnail:thumbnail, absolutePos:absolutePos});
					});
				}

				//동영상을 모두 썸네일로 치환하고 iframe을 찾아서 다시 반복 수행
				function iframeFinder (currentDocument, parentBoundingClientRectTop, parentBoundingClientRectLeft) {
					//현재 document 에서 플래시를 모두 제거
					removeFlash(currentDocument);
					//현재 document 에서 동영상을 모두 썸네일로 치환
					replaceYoutube(currentDocument, parentBoundingClientRectTop, parentBoundingClientRectLeft);
					replaceVimeo(currentDocument, parentBoundingClientRectTop, parentBoundingClientRectLeft);
					replaceTvpot(currentDocument, parentBoundingClientRectTop, parentBoundingClientRectLeft);

					//남아있는 iframe을 검출한 뒤,
					var iframes = currentDocument.querySelectorAll('iframe');

					//각 iframe마다 iframeFinder를 수행
					[].forEach.call(iframes, function (item) {
						//탐색할 iframe의 위치값 추출
						var childBoundingClientRect = item.getBoundingClientRect();
						//iframe 탐색
						iframeFinder(item.contentWindow.document, parentBoundingClientRectTop + childBoundingClientRect.top, parentBoundingClientRectLeft + childBoundingClientRect.left);
					});
				}

				//최상위 window의 body 위치값 추출
				var topBoundingClientRect = document.body.getBoundingClientRect();
				//현재 document부터 썸네일화 시작
				iframeFinder(document, topBoundingClientRect.top, topBoundingClientRect.left);

				//변환된 결과들 리턴
				return mediaProperties;
			});


			//썸네일 로딩이 완료되는 타이밍을 고려
			window.setTimeout(function () {
				//동영상 처리 완료
				resolve(page);
			}, vars.resourceCheckDuration);

		}
		else {
			reject();
		}
    });
};

module.exports = movies;
